# Web 服务端编码规范

服务端统一使用 Drupal 最新稳定版本进行开发。

- [初始化 Drupal 工程](#初始化-Drupal-工程)
- [管理 Composer 依赖](#管理-Composer-依赖)
- [为项目创建安装包](#为项目创建安装包)
- [创建 `自定义模块` 和 `自定义主题`](#创建-自定义模块-和-自定义主题)

## 初始化 Drupal 工程

必须使用 Composer 来管理 Drupal 工程。

Drupal 官方文档 [Develop: Using Composer](https://www.drupal.org/docs/develop/using-composer)
对如何在 Drupal 下使用 Composer 做了详细的说明。这里只对关键的信息进行说明，更多详细信息请参考官方文档。

#### 使用 `Composer 项目模板` 初始化 Drupal 工程

如果你精于 Composer 镜像加速，你可以直接使用 Composer 命令创建工程：

```bash
# 此命令将会创建 8.x 版本的 Drupal 模板工程
composer create-project drupal-composer/drupal-project:8.x-dev some-dir --stability dev --no-interaction
```

但是，我们更推荐直接通过 git 克隆仓库
[https://github.com/drupal-composer/drupal-project](https://github.com/drupal-composer/drupal-project)，
然后由 8.x 分支为源分支，新建一个分支的方式来创建项目工程。
`composer create-project` 本质上是简单地下载此仓库的代码，并执行依赖安装。

## 管理 Composer 依赖

在上文中我们初始化了基于 Composer 管理的 Drupal 工程，在 `drupal-composer/drupal-project` 这个模板工程的根目录中，
`README.md` 文件对工程的目录作了详细的说明，请务必细心阅读。这里仅对 composer.json 文件所做的一些重要事情进行说明一下：

- Drupal 所有的代码，会被安装到 `web` 目录。
- 自动加载入口文件，用 composer所生成的 `vendor/autoload.php` 代替了drupal原本的 `web/vendor/autoload.php`。
- 通过 composer 进行依赖的 `Drupal 模块` (类型为 `drupal-module` 的 composer 包) 会被下载到 `web/modules/contrib/`。
- 通过 composer 进行依赖的 `Drupal 主题` (类型为 `drupal-theme` 的 composer 包) 会被下载到 `web/themes/contrib/`。
- 通过 composer 进行依赖的 `Drupal 安装包` (类型为 `drupal-profile` 的 composer 包) 会被下载到 `web/profiles/contrib/`。
- 在 web/sites/目录下的 default 站点创建可写的 `settings.php` and `services.yml` 站点配置文件。
- 在 web/sites/目录下的 default 站点创建可写的 `files` 目录，作为 default 站点的文件储存位置。
- 最新版本的 `Drush` 被安装到 `vendor/bin/drush`。
- 最新版本的 `DrupalConsole` 被安装到 `vendor/bin/drupal`。
- 根据你在 `*.env` 文件中的定义，创建环境变量， 请参考`.env.example`。

#### 为项目添加 `Composer 依赖`


## 为项目创建安装包

安装包即 [installation profile]()， 是 Drupal 的一个重要特性，一般来说，安装包是`模块`和`主题` 的集合，
外加一些配置和安装脚本，并且可以提供 HOOK 代码。

每一个项目都必须创建一个 profile，使用项目英文代号作为 profile 的机器名。

一般情况下，复制 Drupal Core 的 standard 并修改名字即可，这样效率比较高，不必去完全手写一个新的 profile。

## 创建 `自定义模块` 和 `自定义主题`